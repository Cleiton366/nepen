# ğŸš€ Desafio NEPEN - API

## ğŸ“‹ Ãndice

- [VisÃ£o Geral](#-visÃ£o-geral)
- [Tecnologias Utilizadas](#-tecnologias-utilizadas)
- [Arquitetura e DecisÃµes TÃ©cnicas](#-arquitetura-e-decisÃµes-tÃ©cnicas)
- [Como Executar](#-como-executar)
- [Scripts de Banco de Dados](#-scripts-de-banco-de-dados)
- [Testes de Performance](#-testes-de-performance)
- [Monitoramento e Logs](#-monitoramento-e-logs)
- [Comandos de Desenvolvimento](#-comandos-de-desenvolvimento)

---

## ğŸ¯ VisÃ£o Geral

API desenvolvida para gerenciamento de leituras de medidores com foco em alta performance, resiliÃªncia e escalabilidade. A soluÃ§Ã£o implementa padrÃµes modernos de desenvolvimento e arquitetura limpa.

---

## ğŸ›  Tecnologias Utilizadas

- **.NET 8** â€“ Framework principal  
- **Entity Framework Core** â€“ ORM para acesso a dados  
- **PostgreSQL** â€“ Banco de dados relacional  
- **Redis** â€“ Cache em memÃ³ria distribuÃ­da  
- **Docker** â€“ ContainerizaÃ§Ã£o e orquestraÃ§Ã£o  
- **Serilog** â€“ Logging estruturado  
- **FluentValidation** â€“ ValidaÃ§Ãµes robustas  
- **Artillery** â€“ Testes de performance  

---

## ğŸ— Arquitetura e DecisÃµes TÃ©cnicas

### Clean Architecture

A aplicaÃ§Ã£o segue os princÃ­pios da Clean Architecture, organizando o cÃ³digo em camadas bem definidas:

- **Core** â€“ Entidades e regras de negÃ³cio  
- **Infra** â€“ ImplementaÃ§Ãµes de infraestrutura (EF, Redis)  
- **Api** â€“ Controladores e endpoints  
- **Tests** â€“ Artillery

### Cache com Redis

Implementamos cache distribuÃ­do com Redis para:  
âœ… Melhorar performance em leituras frequentes  
âœ… Reduzir carga no banco de dados  
âœ… Garantir resiliÃªncia em picos de acesso  
âœ… Permitir escalabilidade horizontal  

### Middleware Global de Logs

Middlewares customizados:  
- **AuditMiddleware** â€“ Rastreabilidade completa de requests  
- **ExceptionMiddleware** â€“ Tratamento centralizado de exceÃ§Ãµes  
- Logs estruturados com **Serilog** para melhor anÃ¡lise  

### ValidaÃ§Ãµes Robustas

- **FluentValidation** para validaÃ§Ãµes complexas e customizadas  
- ValidaÃ§Ãµes automÃ¡ticas no pipeline do ASP.NET Core  
- Mensagens de erro claras e contextualizadas  

---

## ğŸš€ Como Executar

### PrÃ©-requisitos

- Docker  
- Docker Compose  

### Comandos RÃ¡pidos

```bash
# Clone o repositÃ³rio
git clone https://github.com/Cleiton366/nepen.git
cd Desafio-NEPEN

# Subir aplicaÃ§Ã£o
docker-compose up 

# Parar aplicaÃ§Ã£o
docker-compose down
```

### VariÃ¡veis de Ambiente

```bash
PostgresConnection="Host=localhost;Database=nepen-dev;Username=postgres;Password=admin;"
Redis__Connection="localhost:6379"
```

### Portas dos ServiÃ§os

- **API**: http://localhost:8080  
- **PostgreSQL**: localhost:5432  
- **Redis**: localhost:6379  

---

## ğŸ’¾ Scripts de Banco de Dados

### Backup do Banco

```bash
# Fazer backup
docker exec -t nepen-postgres pg_dump -h localhost -U postgres -d nepen-dev > backup_$(date +%Y%m%d_%H%M%S).sql

# Backup rÃ¡pido
docker exec -t nepen-postgres pg_dump -h localhost -U postgres -d nepen-dev > backup_banco.sql
```

### Restore do Banco

```bash
# Restaurar a partir do arquivo de backup
cat backup_banco.sql | docker exec -i nepen-postgres psql -h localhost -U postgres -d nepen-dev

# Com verificaÃ§Ã£o
cat backup_banco.sql | docker exec -i nepen-postgres psql -h localhost -U postgres -d nepen-dev && echo "âœ… Restore completed successfully!"
```

---

## ğŸ“Š Testes de Performance

### ExecuÃ§Ã£o Local

```bash
# Navegar para diretÃ³rio de testes
cd src/Com.Nepen.Tests

# Executar testes de performance
artillery run teste-performance.yml

# Ver relatÃ³rio local
open Artillery/report.json
```

### Resultados Online

ğŸ“Š **Dashboard de Performance**:  
[Artillery Dashboard](https://app.artillery.io/share/sh_47dc9224c1f7998bb4952d34c8fcb88a1a27ab88d5bc60cd74c210535ac0287e)

#### MÃ©tricas avaliadas:

âœ… Taxa de requisiÃ§Ãµes por segundo  
âœ… Tempo de resposta mÃ©dio  
âœ… Comportamento sob carga  
âœ… Estabilidade do sistema  

---

## ğŸ“ Monitoramento e Logs

### Rastreabilidade

```bash
# Ver logs da API
docker logs nepen-api

# Acessar pasta de logs
./logs
```

### Estrutura de Logs

- âœ… Correlation ID para rastreamento  
- âœ… Timestamps precisos  
- âœ… MÃ©todo HTTP e path  
- âœ… Status codes  
- âœ… Tempo de resposta  
- âœ… Payloads de request/response  

### Health Checks

```bash
# Verificar saÃºde da API
curl http://localhost:8080/health

# Verificar conexÃ£o com Redis
docker exec -it nepen-redis redis-cli ping

# Verificar conexÃ£o com PostgreSQL
docker exec -t nepen-postgres psql -h localhost -U postgres -d nepen-dev -c "SELECT NOW();"
```

---

## ğŸ”§ Comandos de Desenvolvimento

```bash
# Aplicar migrations
dotnet ef database update

# Build da imagem Docker
docker build -t nepen-api .
```
